# roles/deploy/templates/traefik-config.yml.j2
# Traefik Static Configuration

api:
  dashboard: {{ traefik_dashboard_enabled | default('true') | lower }}
  insecure: {{ traefik_api_insecure | default('false') | lower }}
  debug: {{ traefik_debug | default('false') | lower }}

entryPoints:
  web:
    address: ":80"
    http:
      redirectEntryPoint:
        entryPoint: websecure
  websecure:
    address: ":443"
    http:
      tls:
        certResolver: letsencrypt

providers:
  docker:
    endpoint: unix:///var/run/docker.sock
    exposedByDefault: false
    network: {{ traefik_network | default('app-network') }}
  file:
    filename: /opt/traefik/config/routing.yml
    watch: true

certificatesResolvers:
  letsencrypt:
    acme:
      email: {{ acme_email | default('admin@example.com') }}
      storage: /letsencrypt/acme.json
      httpChallenge:
        entryPoint: web
      {% if production_acme_server | default(false) %}
      caServer: https://acme-v02.api.letsencrypt.org/directory
      {% else %}
      caServer: https://acme-staging-v02.api.letsencrypt.org/directory
      {% endif %}

log:
  level: {{ traefik_log_level | default('INFO') }}
  filePath: /var/log/traefik.log

accessLog:
  filePath: /var/log/traefik-access.log
  format: json

metrics:
  prometheus:
    addEntryPointsLabels: true
    addServicesLabels: true
